<div class="app-container">
  <!-- Overlay qui s'affiche quand la sidebar est ouverte sur mobile -->
  <div class="sidebar-overlay" [class.open]="sidebarOpen" (click)="toggleSidebar()" (keydown)="$event.key === 'Escape' && toggleSidebar()"></div>
  
  <div class="sidebar" [class.open]="sidebarOpen">
    <div class="sidebar-header">
      <div class="logo-container">
        <div class="site-branding">
          <p class="site-title">Où c'est</p>
          <button class="site-logo-btn" (click)="toggleSidebar()" (keydown.enter)="toggleSidebar()" aria-label="Fermer la sidebar">
            <img class="site-logo" src="assets/icons/logo.png" alt="Close">
          </button>
        </div>
        <button (click)="toggleDarkMode()" class="theme-toggle" [class.dark]="darkMode" aria-label="Changer de thème">
          <svg *ngIf="!darkMode" class="sun-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 17C14.7614 17 17 14.7614 17 12C17 9.23858 14.7614 7 12 7C9.23858 7 7 9.23858 7 12C7 14.7614 9.23858 17 12 17Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 1V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 21V23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M4.22 4.22L5.64 5.64" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M18.36 18.36L19.78 19.78" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M1 12H3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M21 12H23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M4.22 19.78L5.64 18.36" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M18.36 5.64L19.78 4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <svg *ngIf="darkMode" class="moon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
    <div class="sidebar-content">
      <app-form></app-form>
    </div>
    <!-- Auth block at the bottom -->
    <div class="auth-block" *ngIf="isAuthenticated">
      <div class="auth-avatar avatar-fallback" aria-hidden="true">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
          <path d="M12 12c2.761 0 5-2.239 5-5s-2.239-5-5-5-5 2.239-5 5 2.239 5 5 5zm0 2c-4.071 0-7 2.343-7 5.25V22h14v-2.75C19 16.343 16.071 14 12 14z"/>
        </svg>
      </div>
      <div class="auth-info">
        <div class="auth-name">{{ userName }}</div>
        <button class="logout-btn" type="button" (click)="logout()">Se déconnecter</button>
      </div>
    </div>
  </div>
  
  <div class="map-container" [class.blur-background]="sidebarOpen">
    
  
    <!-- Composant map -->
    <app-map [leftSidebarOpen]="sidebarOpen"></app-map>
  
    <!-- Logo fixe qui reste visible quand la sidebar est cachée -->
    <button class="fixed-logo" type="button" (click)="toggleSidebar()" (keydown.enter)="toggleSidebar()" *ngIf="!sidebarOpen" [class.loading]="isLoading">
      <div class="logo-icon-container">
        <img src="assets/icons/logo.png" alt="Logo" width="20" height="20">
      </div>
      
      <!-- Loading spinner overlay -->
      <div class="loading-spinner" *ngIf="isLoading">
        <svg class="spinner" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-dasharray="31.4" stroke-dashoffset="31.4">
            <animate attributeName="stroke-dasharray" dur="2s" values="0 31.4;15.7 15.7;0 31.4" repeatCount="indefinite"/>
            <animate attributeName="stroke-dashoffset" dur="2s" values="0;-15.7;-31.4" repeatCount="indefinite"/>
          </circle>
        </svg>
      </div>
      
      <span class="sr-only">Afficher le menu</span>
    </button>
  </div>
</div>