<div class="map-wrapper">
  <!-- Map display component -->
  <div class="map-inner-container">
    <app-map-display
      [currentDataSource]="currentDataSource"
      [activeDataSources]="activeDataSources"
      [usePriceFilter]="usePriceFilter"
      [useDateFilter]="useDateFilter"
      [useSurfaceFilter]="useSurfaceFilter"
      [useEnergyFilter]="useEnergyFilter"
      [useConsumptionFilter]="isConsumptionToggleActive"
      [markersVisible]="markersVisible"
      [tableCollapsed]="tableCollapsed"
      [visibleDvfProperties]="visibleDvfProperties"
      [visibleDpeProperties]="visibleDpeProperties"
      [visibleParcelleProperties]="visibleParcelleProperties"
      (mapMoved)="onMapMoved()"
      (propertySelected)="onPropertySelected($event)">
    </app-map-display>

    <!-- Map controls component (now includes search and alert) -->
    <app-map-controls 
      [isLoading]="isLoading"
      [sidebarOpen]="leftSidebarOpen"
      [resultsOpen]="!tableCollapsed"
      [resultCount]="resultCount"
      [maxResults]="maxResults"
      [activeFilters]="activeFilters"
      (locateUser)="onLocateUser()"
      (toggleSidebar)="onToggleSidebar()"
      (locationSelected)="onLocationSelected($event)"
      (userLocationRequested)="onUserLocationRequested()">
    </app-map-controls>
  </div>

  <!-- Map results component -->
  <app-map-results
    [currentDataSource]="currentDataSource"
    [visibleDvfProperties]="visibleDvfProperties"
    [visibleDpeProperties]="visibleDpeProperties"
    [visibleParcelleProperties]="visibleParcelleProperties"
    [selectedPropertyIndex]="selectedPropertyIndex"
    [tableCollapsed]="tableCollapsed"
    [isLoading]="isLoading"
    (propertySelected)="onPropertySelected($event)"
    (tableToggled)="onTableToggled($event)"
    (mapSizeInvalidated)="onMapSizeInvalidated()">
  </app-map-results>
</div>