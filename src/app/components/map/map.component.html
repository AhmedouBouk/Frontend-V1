<div class="map-wrapper">
  <!-- Map display component -->
  <div class="map-inner-container">
    <app-map-display
      [currentDataSource]="currentDataSource"
      [usePriceFilter]="usePriceFilter"
      [useDateFilter]="useDateFilter"
      [useSurfaceFilter]="useSurfaceFilter"
      [useEnergyFilter]="useEnergyFilter"
      [visibleDvfProperties]="visibleDvfProperties"
      [visibleDpeProperties]="visibleDpeProperties"
      [visibleParcelleProperties]="visibleParcelleProperties"
      (mapMoved)="onMapMoved()"
      (propertySelected)="onPropertySelected($event)">
    </app-map-display>

    <!-- Map controls component -->
    <app-map-controls
      [isLoading]="isLoading"
      (locateUser)="onLocateUser()"
      (toggleSidebar)="onToggleSidebar()">
    </app-map-controls>
  </div>

  <!-- Map results component -->
  <app-map-results
    [currentDataSource]="currentDataSource"
    [visibleDvfProperties]="visibleDvfProperties"
    [visibleDpeProperties]="visibleDpeProperties"
    [visibleParcelleProperties]="visibleParcelleProperties"
    [selectedPropertyIndex]="selectedPropertyIndex"
    [tableCollapsed]="tableCollapsed"
    [isLoading]="isLoading"
    (propertySelected)="onPropertySelected($event)"
    (tableToggled)="onTableToggled()"
    (mapSizeInvalidated)="onMapSizeInvalidated()">
  </app-map-results>
</div>
