<div class="map-wrapper">
  <!-- Alert component for results > 500 -->
  <app-map-alert 
    [resultCount]="resultCount" 
    [maxResults]="maxResults"
    [activeFilters]="activeFilters">
  </app-map-alert>
  <!-- Map display component -->
  <div class="map-inner-container">
    <app-map-display
      [currentDataSource]="currentDataSource"
      [activeDataSources]="activeDataSources"
      [usePriceFilter]="usePriceFilter"
      [useDateFilter]="useDateFilter"
      [useSurfaceFilter]="useSurfaceFilter"
      [useEnergyFilter]="useEnergyFilter"
      [useConsumptionFilter]="isConsumptionToggleActive"
      [markersVisible]="markersVisible"
      [tableCollapsed]="tableCollapsed"
      [visibleDvfProperties]="visibleDvfProperties"
      [visibleDpeProperties]="visibleDpeProperties"
      [visibleParcelleProperties]="visibleParcelleProperties"
      (mapMoved)="onMapMoved()"
      (propertySelected)="onPropertySelected($event)">
    </app-map-display>

    <!-- Map search component -->
    <app-map-search
      [sidebarOpen]="!tableCollapsed"
      (locationSelected)="onLocationSelected($event)"
      (userLocationRequested)="onUserLocationRequested()">
    </app-map-search>

    <!-- Map controls component -->
    <app-map-controls
      [isLoading]="isLoading"
      (locateUser)="onLocateUser()"
      (toggleSidebar)="onToggleSidebar()">
    </app-map-controls>
  </div>

  <!-- Map results component -->
  <app-map-results
    [currentDataSource]="currentDataSource"
    [visibleDvfProperties]="visibleDvfProperties"
    [visibleDpeProperties]="visibleDpeProperties"
    [visibleParcelleProperties]="visibleParcelleProperties"
    [selectedPropertyIndex]="selectedPropertyIndex"
    [tableCollapsed]="tableCollapsed"
    [isLoading]="isLoading"
    (propertySelected)="onPropertySelected($event)"
    (tableToggled)="onTableToggled($event)"
    (mapSizeInvalidated)="onMapSizeInvalidated()">
  </app-map-results>
</div>
