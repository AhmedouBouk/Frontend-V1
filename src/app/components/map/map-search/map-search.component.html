<div class="map-search-container" [class.with-sidebar]="sidebarOpen">
  <!-- Boutons de contrôle - alignés avec le toggle sidebar -->
  <div class="search-controls">
    <!-- Bouton de géolocalisation (maintenant en premier) -->
    <button 
      class="location-btn"
      (click)="requestUserLocation()"
      title="Ma position">
      <!-- Icône de géolocalisation -->
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
      </svg>
    </button>

    <!-- Bouton de recherche (maintenant en second) -->
    <button 
      class="search-toggle-btn"
      (click)="toggleSearch()"
      [class.active]="isSearchOpen"
      title="Rechercher une ville">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M21 21L16.514 16.506M19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </div>

  <!-- Barre de recherche slide -->
  <div class="search-bar" [class.open]="isSearchOpen">
    <div class="search-input-container">
      <!-- Résultats de recherche - maintenant au-dessus de l'input -->
      <div class="search-results search-results-top" *ngIf="showResults && searchResults.length > 0">
        <div 
          class="search-result-item"
          *ngFor="let result of searchResults; trackBy: trackByResult"
          (click)="selectLocation(result)"
          (keydown.enter)="selectLocation(result)"
          tabindex="0"
          role="button">
          <div class="result-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 10C21 17 12 23 12 23S3 17 3 10C3 5.02944 7.02944 1 12 1C16.9706 1 21 5.02944 21 10Z" stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
          <div class="result-text">
            {{ result.display_name }}
          </div>
        </div>
      </div>

      <input 
        type="text"
        class="search-input"
        [(ngModel)]="searchQuery"
        (input)="onSearchInput()"
        (keydown.enter)="onSearchSubmit()"
        (focus)="onSearchFocus()"
        placeholder="Rechercher une ville en France..."
        autocomplete="off">
      
      <div class="search-spinner" *ngIf="isSearching">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2V6M12 18V22M4.93 4.93L7.76 7.76M16.24 16.24L19.07 19.07M2 12H6M18 12H22M4.93 19.07L7.76 16.24M16.24 7.76L19.07 4.93" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
    </div>
  </div>
</div>